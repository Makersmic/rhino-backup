[respond]

[pause_resume]

[display_status]

[gcode_macro CANCEL_PRINT]
description: Cleanly cancel the current print
rename_existing: CANCEL_PRINT_BASE
gcode:
    M117 Canceling print...
    RESPOND TYPE=command MSG="action:notify Print canceled"
    TURN_OFF_HEATERS
    M107 ; Turn off fan
    G91
    G1 Z10 F900 ; Lift Z
    G90
    G28 X Y ; Home X and Y
    SAVE_VARIABLE VARIABLE=pause_state VALUE="'none'"
    CANCEL_PRINT_BASE
    M117 Print canceled
    LEDFLASH


[gcode_macro Bed_Calibrate]
description: Calibrate bed with visual feedback
gcode:
    {% set MATERIAL = printer.save_variables.variables.set_material_material|default("PLA") %}
    {% set NOZZLE_SIZE = printer.save_variables.variables.set_material_nozzle_size|float|default(0.4) %}
    {% set nozzle_key = MATERIAL ~ "_" ~ (NOZZLE_SIZE|string|replace(".", "_")) %}

    M117 Calibrating bed for {MATERIAL}...
    RESPOND TYPE=command MSG="action:notify Calibrating bed for {nozzle_key}"
    LEDFLASH
    LEDMAX
    {% if "xyz" in printer.toolhead.homed_axes %}
        Z_TILT_ADJUST
    {% else %}
        {action_raise_error("Printer not homed for bed calibration")}
    {% endif %}
    M117 Bed calibration complete
    RESPOND TYPE=command MSG="action:notify Bed calibration complete for {nozzle_key}"
    LEDFLASH
    LEDOFF